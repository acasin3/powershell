# Powershell

Collection of useful powershell scripts

## SQLServerDBObjects

Moves scripts generated by SQL Server Management Studio to pre-defined folders by type, i.e., :
- files ending in Schema.sql will be moved to the Schemas folder
- files ending in Table.sql will be moved to the Tables folder
- files ending in View.sql will be moved to the Views folder
- files ending in StoredProcedure.sql will be moved to the StoredProcedures folder
- files ending in UserDefinedFunction.sql will be moved to the UserDefinedFunctions folder
- files ending in Synonym.sql will be moved to the Synonyms folder
- files ending in User.sql will be moved to the Users folder

To generate the scripts in SQL Server Management Studio, please see
https://support.sqldbm.com/knowledge-bases/2/articles/245-how-to-generate-sql-script-from-sql-management-studio-for-reverse-engineering

## add-mysql-linked-server

Contains functions to download the MySQL ODBC from a CDN mirror, install it, create a system DSN, and create a linked server in an SQL Server instance based on the said DSN .

#### Example usage : Method 1

```powershell
$cred = Get-Credential -Message "Enter MySQL credentials"
$downloadUrl = 'https://cdn.mysql.com/Downloads/Connector-ODBC/9.2/mysql-connector-odbc-9.2.0-winx64.msi'

try {
    $cred = Get-Credential -Message "Enter MySQL credentials"
    $downloadUrl = 'https://cdn.mysql.com/Downloads/Connector-ODBC/9.2/mysql-connector-odbc-9.2.0-winx64.msi'

    Start-Download  -DownloadUrl $downloadUrl `
                    -DownloadMessage 'Downloading driver' `
    | Install-MySqlOdbc  `
    | Add-MySqlOdbcDsn  -DsnName "DsnDemoUsingPSWebClient" `
                        -Description "DSN Created via Powershell" `
                        -DriverName "MySQL ODBC 9.2 ANSI Driver" `
                        -DbCredential $cred `
                        -DsnType "System" `
                        -Force `
    | Add-MySQLLinkedServer -serverName 'DESKTOP-I\MSSQLSERVER' `
                            -linkedServerName 'LinkedServerPS' `
                            -dsnName 'DsnDemoUsingPSWebClient' `
                            -credential $cred `
                            -Force
} catch {
    Write-Error "An error occurred: $_"
    # Optionally log it to a file
    # Add-Content -Path "error.log" -Value "$(Get-Date): $_"
}
```


#### Example usage : Method 2

```powershell
try {
    $cred = Get-Credential -Message "Enter MySQL credentials"

    $downloadUrl = 'https://cdn.mysql.com/Downloads/Connector-ODBC/9.2/mysql-connector-odbc-9.2.0-winx64.msi'
    $fileName = $downloadUrl | Split-Path -Leaf
    $outFile = "$env:temp\$fileName"

    Invoke-WebRequest   $downloadUrl -OutFile $outFile
    Install-MySqlOdbc   $outFile
    Add-MySqlOdbcDsn    -DsnName "DsnDemoUsingInvokeWebRequest" `
                        -Description "DSN Created via Powershell" `
                        -DriverName "MySQL ODBC 9.2 ANSI Driver" `
                        -DbCredential $cred `
                        -DsnType "System" `
                        -Force
    Add-MySQLLinkedServer -serverName 'DESKTOP-I\MSSQLSERVER' `
                                -linkedServerName 'LinkedServerPS' `
                                -dsnName 'DsnDemoUsingInvokeWebRequest' `
                                -credential $cred `
                                -Force
} catch {
    $err_message = $_.Exception.Message
    $err_position = ($_.InvocationInfo.PositionMessage).TrimStart('At ')
    Write-Host "'$err_message' $err_position"
}
```

#### Notes:
The difference Method 1 and Method 2 is in how the Install-MySqlOdbc function is used. In Method 1, the path of the downloaded driver is taken from the pipeline, while in Method 2, the path is passed into it.

Getting the installer path from the pipeline in Method 1 is possible because the custom Start-Download function returns the path of the downloaded driver, while Method 2, which uses the built-in Invoke-WebRequest, does not.

#### Future Enhancements:
1. Save credentials in a file instead of prompting the user.
2. Add option to download from alternate mirrors.
3. Add retry option for each mirror in case the download attempt fails.
4. Error logging.

## database-errors

Emails an html file called db_errors.html that contains data stored in the Errors table of the database.